# Foundations

Hardware Abstractions:
- Processor
   - Executes machine instructions generated by the compiler
   - Operates on data using registers and arithmetic/logic units
   - Controls program flow (branches, calls, interrupts)
- Memory
    - Array of bytes used by the processor where each byte has an address
    - Three categories:
        - Registers:
            - Inside the CPU
            - Very fast
            - Hold values currently being operated on
            - Volatile
        - RAM (Random Access Memory)
            - Working memory for running programs
            - Stores variables, stack, and heap
            - Fast; larger than registers
            - Volatile
        - FLASH
            - Non-volatile program and data storage
            - Stores firmware and persistent data
            - Slower than RAM; limited rewrites


Program Execution:
- The processor understands a fixed instruction set
- Instructions perform:
    - Arithmetic/logic operations
    - Reads/writes to registers and memory
- Memory roles:
    - Flash holds the program as a sequence of machine instructions
    - RAM holds the data that the program operates on
- Execution consists of repeatedly:
    - Fetching an instruction from memory
    - Executing it
    - Updating processor state and memory
- Key registers:
    - Program Counter (PC)
        - Holds the address of the current instruction in memory
        - Advances to the next instruction after execution (unless the instruction says otherwise)
    - Stack Pointer (SP)
        - Holds the address of the current stack location in RAM
- Startup requirement:
    - For a program to begin execution, PC and SP must be initialized
        - Initialization cannot be performed by the program
        - Instead, it is handled by hardware

Reset and Program Startup (Cortex-M)
- Reset behavior:
    - On power-up/reset, the processor enters a Reset exception
    - Reset is an exception that halts normal execution
    - When reset is released, execution restarts from an address defined by hardware data structures
- Exceptions:
    - An event that changes the processor's execution context
    - Entering an exception updates the key registers, including PC and SP
- Vector table:
    - A fixed table in memory that defines how the processor starts and handles exceptions
    - On reset, the vector table is located at address 0x00000000
    - Each entry contains an address used to initialize the execution state
        - Entry 0: Initial value of SP
        - Entry 1: Reset handler address (loaded into PC)
- Stack initialization:
    - The stack resides in RAM and grows toward lower addresses
    - SP is initialized to the highest valid RAM address
- Program Start:
    - After reset:
        - SP is loaded from vector table entry 0
        - PC is loaded from vector table entry 1
    - Execution begins at the reset handler
    - The reset handler handles system initialization and calling `main`